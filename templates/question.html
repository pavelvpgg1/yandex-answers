{% extends "base.html" %}
{% block content %}
    <h2>{{ question.title }}</h2>
    <div>
        <b>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</b> {{ question.category.name if question.category else '' }}<br>
        <b>–ê–≤—Ç–æ—Ä:</b> {{ question.user.username }}<br>
        <p>{{ question.body }}</p>
    </div>
    <div>
        <button class="btn" onclick="likeObject('question', {{ question.id }}, 'like')">üëç</button>
        <span id="question-likes">{{ question.rating or 0 }}</span>
        <button class="btn" onclick="likeObject('question', {{ question.id }}, 'dislike')">üëé</button>
    </div>
    <hr>
    <h3>–û—Ç–≤–µ—Ç—ã:</h3>
    <ul>
        {% for a in answers %}
            <li>
                <b>{{ a.user.username }}</b> (–æ—Ü–µ–Ω–∫–∞: <span id="answer-{{ a.id }}-likes">{{ a.rating or 0 }}</span>)
                <button class="btn" onclick="likeObject('answer', {{ a.id }}, 'like')">üëç</button>
                <button class="btn" onclick="likeObject('answer', {{ a.id }}, 'dislike')">üëé</button>
                <br>{{ a.body }}
            </li>
        {% else %}
            <li>–û—Ç–≤–µ—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</li>
        {% endfor %}
    </ul>
    {% if current_user.is_authenticated %}
        <h4>–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</h4>
        <form method="post">
            {{ form.hidden_tag() }}
            {{ form.body.label }} {{ form.body(rows=4) }}
            {{ form.submit() }}
        </form>
    {% else %}
        <p>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–≤–µ—Ç–∏—Ç—å.</p>
    {% endif %}
    <script>
        function likeObject(type, id, action) {
            fetch(`/like/${type}/${id}/${action}`, {method: 'POST'})
                .then(r => r.json()).then(data => {
                if (type === 'question') {
                    document.getElementById('question-likes').innerText = data.likes - data.dislikes;
                } else {
                    document.getElementById(`answer-${id}-likes`).innerText = data.likes - data.dislikes;
                }
            });
        }
    </script>
{% endblock %}


